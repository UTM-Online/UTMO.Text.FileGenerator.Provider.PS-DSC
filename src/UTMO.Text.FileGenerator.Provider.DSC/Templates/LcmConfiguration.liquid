{% extends "script_base" %}
{% block script %}
[DscLocalConfigurationManager()]
Configuration LocalConfigApplication
{
    node {{ node_name }}
    {
        Settings
        {
            RefreshFrequencyMins = {{ lcm_settings.RefreshFrequencyMins }};
            RefreshMode = '{{ lcm_settings.RefreshMode }}';
            ConfigurationMode = '{{ lcm_settings.ConfigurationMode }}';
            AllowModuleOverwrite = {{ lcm_settings.AllowModuleOverwrite }};
            RebootNodeIfNeeded = {{ lcm_settings.RebootNodeIfNeeded }};
            ConfigurationModeFrequencyMins = {{ lcm_settings.ConfigurationModeFrequencyMins }};
        }
    
        ConfigurationRepositoryWeb PullSrvCfg
        {
            ServerURL = "{{ server_url }}"
            RegistrationKey = "{{ registration_key }}"
            ConfigurationNames = @({% for cfg in partial_configs %}"{{ cfg.FullName }}"{% if partial_configs.last != cfg  %},{% endif %}{% endfor %})
        }
        
        ResourceRepositoryWeb PullSrvMod
        {
            ServerUrl       = "{{ server_url }}"
            RegistrationKey = "{{ registration_key }}"
        }
        
        ReportServerWeb PullSrvRpt
        {
            ServerURL = "{{ server_url }}"
            RegistrationKey = "{{ registration_key }}"
        }
        
        {% for cfg in partial_configs %}
        PartialConfiguration {{ cfg.FullName }}
        {
            Description = "{{ cfg.Description }}"
            RefreshMode = "{{ cfg.Mode }}"{%- if cfg.Mode == "Pull" %}
            ResourceModuleSource = "{{ module_source }}"
            ConfigurationSource = "{{ config_source }}"{%- endif %}
        }{% endfor %}
    }
}

LocalConfigApplication -OutputPath $OutputPath{% endblock %}