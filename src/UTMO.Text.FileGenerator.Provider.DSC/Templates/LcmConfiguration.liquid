{% extends "script_base" %}
{% block script %}
[DscLocalConfigurationManager()]
Configuration LocalConfigApplication
{
    node {{ node_name }}
    {
        Settings
        {
            RefreshFrequencyMins = {{ lcm_settings.RefreshFrequencyMins }};
            RefreshMode = '{{ lcm_settings.RefreshMode }}';
            ConfigurationMode = '{{ lcm_settings.ConfigurationMode }}';
            AllowModuleOverwrite = {{ lcm_settings.AllowModuleOverwrite }};
            RebootNodeIfNeeded = {{ lcm_settings.RebootNodeIfNeeded }};
            ConfigurationModeFrequencyMins = {{ lcm_settings.ConfigurationModeFrequencyMins }};
        }

{%- for resource in web_resources %}
        {{ resource.lcm_resource_type }} {{ resource.lcm_resource_name }}
        {
            ServerURL = "{{ resource.server_url }}"
            RegistrationKey = "{{ resource.registration_key }}"{% if resource.configuration_names != empty %}
            ConfigurationNames = @({% for cfg in resource.configuration_names %}"{{ cfg }}"{% if forloop.last != cfg  %},{% endif %}{% endfor %}){% endif %}
        }
{% endfor %}
        
        {% for cfg in partial_configs %}
        PartialConfiguration {{ cfg.FullName }}
        {
            Description = "{{ cfg.Description }}"
            RefreshMode = "{{ cfg.Mode }}"{%- if cfg.Mode == "Pull" %}
            ResourceModuleSource = "{{ module_source }}"
            ConfigurationSource = "{{ config_source }}"{%- endif %}
        }{% endfor %}
    }
}

LocalConfigApplication -OutputPath $OutputPath{% endblock %}