{% extends "script_base" %}
{% block script %}
Configuration {{ FullName }}
{
{%- for module in RequiredModules %}
{% if module.UseAlternateFormat == true -%}
    Import-DscResource -ModuleName @{ModuleName = '{{ module.Name }}'; RequiredVersion = '{{ module.Version }}'}{%- else -%}
    Import-DscResource -ModuleName '{{ module.Name }}' {% if module.Version and module.Name != "PSDesiredStateConfiguration" %}-ModuleVersion '{{ module.Version }}'{% endif -%}{% endif -%}{% endfor %}

{% for resource in ConfigurationResources -%}
    {{ resource.resource_id }} "{{ resource.name }}"
    {
        {% for value in resource.property_bag %}{{ value.Key }} = {{ value.Value }}{% if forloop.last == false %}
        {% endif %}{% endfor %}{% if resource.has_ensure == true %}
        Ensure = '{{ resource.ensure }}'{% endif %}{% if resource.depends_on != empty %}
        DependsOn = @({% for item in resource.depends_on %}'{{ item }}'{% if forloop.last == false %}, {% endif %}{% endfor %}){% endif %}
    }{% if forloop.last == false %}

{% endif %}{% endfor %}
}

{{ FullName }} -OutputPath $OutputPath
Rename-Item -Path $(Join-Path -Path $OutputPath -ChildPath "localhost.mof") -NewName "{{ FullName }}.mof"
{% endblock %}